<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AN-225 Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/loaders/MTLLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        body {
            margin: 0;
            overflow-x: hidden;
            background: black;
        }
        /* –°—Ç–∏–ª—ñ –¥–ª—è –ø–µ—Ä—à–æ–≥–æ –∞–Ω—ñ–º–æ–≤–∞–Ω–æ–≥–æ –±–ª–æ–∫—É */
        .section3 {
            width: 100%;
            height: 100vh;
            position: relative;
        }
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–µ—Ä—à–æ—ó –º–æ–¥–µ–ª—ñ */
        #animation-block {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥—Ä—É–≥–æ—ó –º–æ–¥–µ–ª—ñ */
        #viewer-container {
            width: 100%;
            position: absolute;
            right: 0;
        }
    </style>
</head>
<body>

<!-- AN-225 (–∞–Ω—ñ–º–∞—Ü—ñ—è –ø—ñ–¥ —á–∞—Å —Å–∫—Ä–æ–ª—É) -->
<section class="section3">
    <div class="text3">
        <h3 class="istok-web-bold">AN-225 ‚Äú–ú–†–Ü–Ø‚Äù</h3>
        <h5 class="istok-web-bold">The largest airplane in the world!<span>‚úàÔ∏èüá∫üá¶</span></h5>
    </div>
    <div id="animation-block"></div>
</section>

<!-- AN-225 (–≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è obj+mtl) -->
<section id="viewer-container"></section>

<script>
    // ************** –ü–µ—Ä—à–∞ —Å—Ü–µ–Ω–∞: –ê–Ω—ñ–º–æ–≤–∞–Ω–∏–π –ª—ñ—Ç–∞–∫ (GLTF) ************** //
    // –°—Ç–≤–æ—Ä—é—î–º–æ —Å—Ü–µ–Ω—É, –∫–∞–º–µ—Ä—É —Ç–∞ —Ä–µ–Ω–¥–µ—Ä–µ—Ä
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ 
    antialias: true,
    alpha: true
    });

    // –û—Ç—Ä–∏–º—É—î–º–æ –±–ª–æ–∫ –∞–Ω—ñ–º–∞—Ü—ñ—ó —Ç–∞ –¥–æ–¥–∞—î–º–æ canvas
    const animationBlock = document.getElementById('animation-block');
    renderer.setSize(animationBlock.clientWidth, animationBlock.clientHeight);
    animationBlock.appendChild(renderer.domElement);

    // –î–æ–¥–∞—î–º–æ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è –¥–æ —Å—Ü–µ–Ω–∏
    scene.add(new THREE.AmbientLight(0xffffff, 1));

    let model; // –ó–º—ñ–Ω–Ω–∞ –¥–ª—è –º–æ–¥–µ–ª—ñ –ª—ñ—Ç–∞–∫–∞
    const startX = -1500; // –ü–æ—á–∞—Ç–∫–æ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è –ø–æ X
    const endX = 600; // –ö—ñ–Ω—Ü–µ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è –ø–æ X
    const flightHeight = 400; // –í–∏—Å–æ—Ç–∞ –ø–æ–ª—å–æ—Ç—É

    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ 3D-–º–æ–¥–µ–ª—å –ª—ñ—Ç–∞–∫–∞
    const loader = new THREE.GLTFLoader();
    loader.load(
    'model.glb',
    (gltf) => {
        model = gltf.scene;
        model.position.set(startX, flightHeight, 0);
        model.rotation.y = Math.PI * 1.5; // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –ª—ñ—Ç–∞–∫ —É –ø–æ—Ç—Ä—ñ–±–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É

        // –û–Ω–æ–≤–ª—é—î–º–æ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –≤—Å—ñ—Ö —á–∞—Å—Ç–∏–Ω –º–æ–¥–µ–ª—ñ
        model.traverse((child) => {
        if (child.isMesh) {
            child.material = new THREE.MeshBasicMaterial({ 
            color: child.material.color,
            map: child.material.map
            });
            
            console.log(`–ú–∞—Ç–µ—Ä—ñ–∞–ª: ${child.material.name}`);
            console.log("BaseColorTexture:", child.material.map);
        }
        });
        
        scene.add(model); // –î–æ–¥–∞—î–º–æ –º–æ–¥–µ–ª—å —É —Å—Ü–µ–Ω—É
    },
    undefined,
    (error) => {
        console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ:", error); // –í–∏–≤–æ–¥–∏–º–æ –ø–æ–º–∏–ª–∫—É –≤ –∫–æ–Ω—Å–æ–ª—å
    }
    );

    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–µ –ø–æ–ª–æ–∂–µ–Ω–Ω—è –∫–∞–º–µ—Ä–∏
    camera.position.set(0, 800, 500);
    camera.lookAt(0, flightHeight, 0);

    // –§—É–Ω–∫—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Å–∫—Ä–æ–ª—É
    function updateAnimation() {
    if (!model) return; // –ü–µ—Ä–µ–∫–æ–Ω—É—î–º–æ—Å—å, —â–æ –º–æ–¥–µ–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞
    const rect = animationBlock.getBoundingClientRect(); // –û—Ç—Ä–∏–º—É—î–º–æ —Ä–æ–∑–º—ñ—Ä–∏ –±–ª–æ–∫—É
    
    // –û–±—á–∏—Å–ª—é—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å –∞–Ω—ñ–º–∞—Ü—ñ—ó (–≤—ñ–¥ 0 –¥–æ 1)
    const progress = Math.min(1, Math.max(0, (window.innerHeight - rect.top) / window.innerHeight / 2));
    
    // –û–Ω–æ–≤–ª—é—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –ª—ñ—Ç–∞–∫–∞ –ø–æ X —Ç–∞ –Ω–∞—Ö–∏–ª –ø–æ Z
    model.position.x = startX + (endX - startX) * progress;
    model.rotation.z = -progress * 0.6;

    // –û–Ω–æ–≤–ª—é—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –∫–∞–º–µ—Ä–∏ –º—ñ–∂ –¥–≤–æ–º–∞ –∑–∞–¥–∞–Ω–∏–º–∏ —Ç–æ—á–∫–∞–º–∏
    const startCam = new THREE.Vector3(0, 950, 500);
    const endCam = new THREE.Vector3(0, 450, 200);
    camera.position.lerpVectors(startCam, endCam, progress);
    camera.lookAt(new THREE.Vector3(0, flightHeight, 0)); // –°–ø—Ä—è–º–æ–≤—É—î–º–æ –∫–∞–º–µ—Ä—É –Ω–∞ –ª—ñ—Ç–∞–∫
    }

    // –ó–∞–ø—É—Å–∫–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó –ø—ñ–¥ —á–∞—Å —Å–∫—Ä–æ–ª—É
    window.addEventListener('scroll', updateAnimation);

    // –§—É–Ω–∫—Ü—ñ—è –±–µ–∑–ø–µ—Ä–µ—Ä–≤–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É —Å—Ü–µ–Ω–∏
    function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
    }
    animate(); // –ó–∞–ø—É—Å–∫–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é

    // –û–Ω–æ–≤–ª—é—î–º–æ —Ä–æ–∑–º—ñ—Ä —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞ –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ä–æ–∑–º—ñ—Ä—É –≤—ñ–∫–Ω–∞
    function onResize() {
    renderer.setSize(animationBlock.clientWidth, animationBlock.clientHeight);
    camera.aspect = animationBlock.clientWidth / animationBlock.clientHeight;
    camera.updateProjectionMatrix();
    updateAnimation(); // –û–Ω–æ–≤–ª—é—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏ —Ä–æ–∑–º—ñ—Ä—É
    }
    window.addEventListener('resize', onResize);


    // ************** –î—Ä—É–≥–∞ —Å—Ü–µ–Ω–∞: –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è OBJ+MTL ************** //
    const scene2 = new THREE.Scene();
    const camera2 = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer2 = new THREE.WebGLRenderer({ alpha: true });

    const viewerContainer = document.getElementById('viewer-container');
    renderer2.setSize(viewerContainer.clientWidth, viewerContainer.clientHeight);
    viewerContainer.appendChild(renderer2.domElement);

    scene2.add(new THREE.AmbientLight(0xffffff, 1));
    const rotatingLight = new THREE.PointLight(0xffffff, 2);
    scene2.add(rotatingLight);

    const controls = new THREE.OrbitControls(camera2, renderer2.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.enablePan = false;
    controls.enableRotate = true;
    controls.enableZoom = true;
    controls.autoRotate = true;
    controls.autoRotateSpeed = 1.0;

    const mtlLoader = new THREE.MTLLoader();
    mtlLoader.load('An-225_cutout/Mriya_edited3_wing_fuselage_fix_onlyplane.mtl', (materials) => {
        materials.preload();
        const objLoader = new THREE.OBJLoader();
        objLoader.setMaterials(materials);
        objLoader.load('An-225_cutout/Mriya_edited3_wing_fuselage_fix_onlyplane.obj', (object) => {
            object.position.set(13, 0, 30);
            scene2.add(object);
            controls.target.set(0, 0, 0);
            controls.update();
        });
    });

    camera2.position.set(13, 40, 75);

    function animate2() {
        requestAnimationFrame(animate2);
        controls.update();
        const time = Date.now() * 0.001;
        const radius = 70;
        rotatingLight.position.set(Math.cos(time) * radius, 20, Math.sin(time) * radius);
        renderer2.render(scene2, camera2);
    }
    animate2();

    window.addEventListener('resize', () => {
        renderer2.setSize(viewerContainer.clientWidth, viewerContainer.clientHeight);
        camera2.aspect = viewerContainer.clientWidth / viewerContainer.clientHeight;
        camera2.updateProjectionMatrix();
    });
</script>

</body>
</html>
